{% if page.permalink == "/success/" %}
<script>
  (function () {
    const confettiRoot = document.getElementById("confetti");
    const partyBtn = document.getElementById("partyBtn");
    function burst(count) {
      if (!confettiRoot) return;
      // XSS-safe: Clear children without innerHTML
      while (confettiRoot.firstChild) {
        confettiRoot.removeChild(confettiRoot.firstChild);
      }
      const reduce =
        window.matchMedia &&
        window.matchMedia("(prefers-reduced-motion: reduce)").matches;
      if (reduce) return;
      const colors = [
        "#0b6cff",
        "#10b981",
        "#f59e0b",
        "#ef4444",
        "#a855f7",
        "#14b8a6",
      ];
      for (let i = 0; i < count; i++) {
        const piece = document.createElement("i");
        const x = Math.floor(Math.random() * 100) + "vw";
        const dx = (Math.random() * 40 - 20).toFixed(1) + "vw";
        const r = Math.floor(Math.random() * 360) + "deg";
        const d = (Math.random() * 1.2 + 1.3).toFixed(2) + "s";
        piece.style.setProperty("--x", x);
        piece.style.setProperty("--dx", dx);
        piece.style.setProperty("--r", r);
        piece.style.setProperty("--d", d);
        piece.style.background =
          colors[Math.floor(Math.random() * colors.length)];
        if (Math.random() > 0.7) {
          piece.style.width = "12px";
          piece.style.height = "12px";
          piece.style.borderRadius = "999px";
        } else if (Math.random() > 0.7) {
          piece.style.height = "20px";
        }
        confettiRoot.appendChild(piece);
      }
      window.setTimeout(() => {
        // XSS-safe: Clear children without innerHTML
        while (confettiRoot.firstChild) {
          confettiRoot.removeChild(confettiRoot.firstChild);
        }
      }, 3200);
    }
    window.setTimeout(() => burst(42), 180);
    if (partyBtn) partyBtn.addEventListener("click", () => burst(55));
  })();
</script>
{% endif %}
