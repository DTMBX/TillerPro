{%- assign min_h = include.min | default: 2 -%}
{%- assign max_h = include.max | default: 3 -%}

{%- capture content_html -%}{{ content }}{%- endcapture -%}
{%- assign items = content_html | split: "<h" -%}

{%- assign has = false -%}
{%- for chunk in items -%}
  {%- assign tag = chunk | slice: 0, 1 -%}
  {%- if tag == "2" or tag == "3" -%}
    {%- assign has = true -%}
  {%- endif -%}
{%- endfor -%}

{%- if has -%}
  <nav class="toc" aria-label="On this page">
    <div class="toc__title">On this page</div>
    <ol class="toc__list">
      {%- for chunk in items -%}
        {%- assign tag = chunk | slice: 0, 1 -%}
        {%- if tag == "2" or tag == "3" -%}
          {%- assign h_level = tag | plus: 0 -%}
          {%- if h_level >= min_h and h_level <= max_h -%}
            {%- assign id_part = chunk | split: 'id="' -%}
            {%- if id_part.size > 1 -%}
              {%- assign id = id_part[1] | split: '"' | first -%}
              {%- assign text = chunk | split: ">" -%}
              {%- assign text = text[1] | split: "</h" | first -%}
              <li class="toc__item level-{{ h_level }}">
                <a class="toc__link" href="#{{ id }}">{{ text | strip_html | strip }}</a>
              </li>
            {%- endif -%}
          {%- endif -%}
        {%- endif -%}
      {%- endfor -%}
    </ol>
  </nav>
{%- endif -%}